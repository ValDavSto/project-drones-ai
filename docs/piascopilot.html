<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-06T18:54:33.9209166"><title>Pi as Co-Pilot | Drone Project</title><script type="application/json" id="virtual-toc-data">[{"id":"overview","level":0,"title":"Overview","anchor":"#overview"},{"id":"hardware-connection","level":0,"title":"Hardware Connection","anchor":"#hardware-connection"},{"id":"software","level":0,"title":"Software","anchor":"#software"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Pi as Co-Pilot | Drone Project"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Drone Project Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/piascopilot.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Pi as Co-Pilot | Drone Project"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/piascopilot.html#webpage",
    "url": "writerside-documentation/piascopilot.html",
    "name": "Pi as Co-Pilot | Drone Project",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Drone Project Help"
}</script><!-- End Schema.org --></head><body data-id="PiAsCoPilot" data-main-title="Pi as Co-Pilot" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Drone Project  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PiAsCoPilot" id="PiAsCoPilot.md">Pi as Co-Pilot</h1><p id="ydpfqk_3">This topic explains how we use a Raspberry Pi to control the drone either alongside or independently of the pilot. <br> The Pi communicates with the Betaflight flight controller using the MSP (MultiWii Serial Protocol) over a UART interface.</p><section class="chapter"><h2 id="overview" data-toc="overview">Overview</h2><p id="ydpfqk_9">The Raspberry Pi acts as a co-pilot that sends flight commands and receives telemetry from the flight controller. <br> It operates in two distinct modes, determined by the <code class="code" id="ydpfqk_14">MSP OVERRIDE</code> switch position in Betaflight:</p><ul class="list _bullet" id="ydpfqk_10"><li class="list__item" id="ydpfqk_15"><p id="ydpfqk_17"><span class="control" id="ydpfqk_18">Stable Mode (AUX3: 1300&ndash;1700)</span> &ndash; The Pi sends input values that keep the drone flying in a stable, level position.</p></li><li class="list__item" id="ydpfqk_16"><p id="ydpfqk_19"><span class="control" id="ydpfqk_21">Object Detection Mode (AUX3: 1800&ndash;2100)</span> &ndash; The Pi moves the drone forward slightly. It uses object detection to identify colors:</p><ul class="list _bullet" id="ydpfqk_20"><li class="list__item" id="ydpfqk_22"><p id="ydpfqk_24">If a <span class="control" id="ydpfqk_25">red object</span> is detected, the drone turns slightly <span class="control" id="ydpfqk_26">left</span></p></li><li class="list__item" id="ydpfqk_23"><p id="ydpfqk_27">If a <span class="control" id="ydpfqk_28">blue object</span> is detected, the drone turns slightly <span class="control" id="ydpfqk_29">right</span></p></li></ul></li></ul><aside class="prompt" data-type="tip" data-title="" id="ydpfqk_11"><p id="ydpfqk_30">See <a href="betaflightsetup.html" id="ydpfqk_31" data-tooltip="This guide describes the steps we took to configure our drone using Betaflight.">Betaflight Setup</a> for how the <code class="code" id="ydpfqk_32">MSP OVERRIDE</code> mode is configured.</p></aside></section><section class="chapter"><h2 id="hardware-connection" data-toc="hardware-connection">Hardware Connection</h2><p id="ydpfqk_33">Connect the Raspberry Pi to the flight controller via a UART interface:</p><ul class="list _bullet" id="ydpfqk_34"><li class="list__item" id="ydpfqk_37"><p id="ydpfqk_39"><span class="control" id="ydpfqk_40">Pi TX</span> &rarr; <span class="control" id="ydpfqk_41">FC RX</span> (e.g., UART3)</p></li><li class="list__item" id="ydpfqk_38"><p id="ydpfqk_42"><span class="control" id="ydpfqk_43">Pi RX</span> &rarr; <span class="control" id="ydpfqk_44">FC TX</span></p></li></ul><aside class="prompt" data-type="tip" data-title="" id="ydpfqk_35"><p id="ydpfqk_45">For details on powering the Raspberry Pi safely from the drone, see <a href="power-supply.html" id="ydpfqk_46" data-tooltip="A challenge we faced while building our drone is how to power additional peripherals like the Raspberry Pi, its PI Camera Module, the Coral Edge TPU and the Electro Magnet.">Power Supply</a>.</p></aside></section><section class="chapter"><h2 id="software" data-toc="software">Software</h2><p id="ydpfqk_47">We use a Python program on the Raspberry Pi to interact with the drone via the <span class="control" id="ydpfqk_50">MSP protocol</span> (MultiWii Serial Protocol). The Pi communicates directly with the flight controller over a UART connection and sends flight control commands like roll, pitch, yaw, and throttle.</p><section class="chapter"><h3 id="behavior-overview" data-toc="behavior-overview">Behavior Overview</h3><p id="ydpfqk_51">The program continuously reads the drone's <span class="control" id="ydpfqk_56">AUX channels</span> to decide what to do:</p><ul class="list _bullet" id="ydpfqk_52"><li class="list__item" id="ydpfqk_57"><p id="ydpfqk_60"><span class="control" id="ydpfqk_62">AUX3</span> controls the flight behavior:</p><ul class="list _bullet" id="ydpfqk_61"><li class="list__item" id="ydpfqk_63"><p id="ydpfqk_66"><span class="control" id="ydpfqk_67">&lt; 1400</span>: MSP Override is off &ndash; the Pi does nothing.</p></li><li class="list__item" id="ydpfqk_64"><p id="ydpfqk_68"><span class="control" id="ydpfqk_69">1400&ndash;1900</span>: Stable hover mode &ndash; the Pi keeps the drone in position.</p></li><li class="list__item" id="ydpfqk_65"><p id="ydpfqk_70"><span class="control" id="ydpfqk_71">&gt; 1900</span>: Object detection mode &ndash; the Pi moves the drone forward slightly, and reacts to detected objects.</p></li></ul></li><li class="list__item" id="ydpfqk_58"><p id="ydpfqk_72"><span class="control" id="ydpfqk_73">AUX5</span> activates the magnet (e.g., to pick up a payload).</p></li><li class="list__item" id="ydpfqk_59"><p id="ydpfqk_74"><span class="control" id="ydpfqk_75">AUX6</span> deactivates the magnet (e.g., to drop a payload).</p></li></ul><p id="ydpfqk_53">All flight commands are sent via a custom <code class="code" id="ydpfqk_76">MSP</code> class, which uses the serial port to exchange MSP messages with the flight controller. The Pi sends new RC values and also reads existing channel values, to combine its flight input with the AUX values set by the pilot.</p><aside class="prompt" data-type="tip" data-title="" id="ydpfqk_54"><p id="ydpfqk_77">See more to Package Transportation here: <a href="package-transportation.html" id="ydpfqk_78" data-tooltip="Our drone is required to handle payload pickup and drop-off of a prepared package.">Package Transportation</a></p></aside><aside class="prompt" data-type="tip" data-title="" id="ydpfqk_55"><p id="ydpfqk_79">The full MSP protocol implementation is written in Python and handles packet formatting, communication over UART, and RC channel synchronization.</p></aside></section><section class="chapter"><h3 id="msp-communication-class" data-toc="msp-communication-class">MSP Communication Class</h3><p id="ydpfqk_80">The custom <code class="code" id="ydpfqk_84">MSP</code> class provides methods to:</p><ul class="list _bullet" id="ydpfqk_81"><li class="list__item" id="ydpfqk_85"><p id="ydpfqk_88">Send RC data to the flight controller (<code class="code" id="ydpfqk_89">send_rc</code>)</p></li><li class="list__item" id="ydpfqk_86"><p id="ydpfqk_90">Read all current RC channels (<code class="code" id="ydpfqk_91">read_rc</code>)</p></li><li class="list__item" id="ydpfqk_87"><p id="ydpfqk_92">Send flight input (roll, pitch, yaw, throttle) while preserving AUX values (<code class="code" id="ydpfqk_93">send_flight_control</code>)</p></li></ul><p id="ydpfqk_82">It handles packet formatting according to the MSP protocol and runs over a serial UART interface (e.g., <code class="code" id="ydpfqk_94">/dev/serial0</code> or <code class="code" id="ydpfqk_95">COM5</code>). The protocol uses a binary message format with checksums to ensure reliable communication.</p><p id="ydpfqk_83">This allows the Raspberry Pi to behave as an auxiliary flight control unit, without interfering with pilot input unless MSP Override is enabled.</p></section></section><div class="last-modified">06 Juli 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="package-transportation.html" class="navigation-links__prev">Package Transportation</a><a href="betaflightsetup.html" class="navigation-links__next">Betaflight Setup</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>