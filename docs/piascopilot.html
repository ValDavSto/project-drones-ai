<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-09T22:25:29.2293433"><title>Pi as Co-Pilot | Drone Project</title><script type="application/json" id="virtual-toc-data">[{"id":"overview","level":0,"title":"Overview","anchor":"#overview"},{"id":"hardware-setup","level":0,"title":"Hardware Setup","anchor":"#hardware-setup"},{"id":"software-architecture","level":0,"title":"Software Architecture","anchor":"#software-architecture"},{"id":"msp-communication-module","level":0,"title":"MSP Communication Module","anchor":"#msp-communication-module"},{"id":"co-pilot-flight-logic","level":0,"title":"Co-Pilot Flight Logic","anchor":"#co-pilot-flight-logic"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Pi as Co-Pilot | Drone Project"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Drone Project Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/piascopilot.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Pi as Co-Pilot | Drone Project"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/piascopilot.html#webpage",
    "url": "writerside-documentation/piascopilot.html",
    "name": "Pi as Co-Pilot | Drone Project",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Drone Project Help"
}</script><!-- End Schema.org --></head><body data-id="PiAsCoPilot" data-main-title="Pi as Co-Pilot" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Drone Project  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PiAsCoPilot" id="PiAsCoPilot.md">Pi as Co-Pilot</h1><p id="-y7z7qv_3">This section describes how we utilize a Raspberry Pi Zero 2W as an intelligent co-pilot for our drone system. The Raspberry Pi communicates with the Betaflight flight controller using the MultiWii Serial Protocol (MSP) over a UART interface. This setup enables semi-autonomous flight behavior while maintaining full compatibility with manual pilot inputs.</p><section class="chapter"><h2 id="overview" data-toc="overview">Overview</h2><p id="-y7z7qv_10">The Raspberry Pi serves as an auxiliary flight control unit that interacts with the main flight controller. It sends RC commands and reads telemetry data using MSP over a serial interface. Depending on the flight mode selected via the Betaflight AUX3 channel, the Pi executes different behaviors.</p><p id="-y7z7qv_11">There are two main operational modes:</p><ul class="list _bullet" id="-y7z7qv_12"><li class="list__item" id="-y7z7qv_15"><p id="-y7z7qv_17"><span class="control" id="-y7z7qv_18">Stable Hover Mode</span> (<code class="code" id="-y7z7qv_19">AUX3: 1300&ndash;1800</code>): <br> In this mode, the Pi takes over the control sticks to maintain a level and stable hover. It continuously sends neutral control values to keep the drone steady.</p></li><li class="list__item" id="-y7z7qv_16"><p id="-y7z7qv_21"><span class="control" id="-y7z7qv_23">Object Detection Mode</span> (<code class="code" id="-y7z7qv_24">AUX3: 1800&ndash;2100</code>): <br> The Pi initiates forward motion and simultaneously performs object detection. Based on the detected object's color, it steers the drone:</p><ul class="list _bullet" id="-y7z7qv_22"><li class="list__item" id="-y7z7qv_26"><p id="-y7z7qv_28"><span class="control" id="-y7z7qv_29">Red object</span> &rarr; slight turn to the <span class="control" id="-y7z7qv_30">left</span></p></li><li class="list__item" id="-y7z7qv_27"><p id="-y7z7qv_31"><span class="control" id="-y7z7qv_32">Blue object</span> &rarr; slight turn to the <span class="control" id="-y7z7qv_33">right</span></p></li></ul></li></ul><aside class="prompt" data-type="tip" data-title="" id="-y7z7qv_13"><p id="-y7z7qv_34">For configuration details, refer to <a href="betaflightsetup.html" id="-y7z7qv_35" data-tooltip="This guide describes the steps we took to configure our drone using Betaflight.">Betaflight Setup</a>, which explains how to enable MSP Override mode.</p></aside></section><section class="chapter"><h2 id="hardware-setup" data-toc="hardware-setup">Hardware Setup</h2><p id="-y7z7qv_36">To establish communication between the Raspberry Pi and the flight controller, connect the two devices via a UART interface:</p><ul class="list _bullet" id="-y7z7qv_37"><li class="list__item" id="-y7z7qv_39"><p id="-y7z7qv_41"><span class="control" id="-y7z7qv_42">Raspberry Pi TX</span> &rarr; <span class="control" id="-y7z7qv_43">Flight Controller RX</span> (e.g., UART3)</p></li><li class="list__item" id="-y7z7qv_40"><p id="-y7z7qv_44"><span class="control" id="-y7z7qv_45">Raspberry Pi RX</span> &rarr; <span class="control" id="-y7z7qv_46">Flight Controller TX</span></p></li></ul><p id="-y7z7qv_38">Ensure the Pi is properly powered from the drone's power system.</p></section><section class="chapter"><h2 id="software-architecture" data-toc="software-architecture">Software Architecture</h2><p id="-y7z7qv_47">A custom Python script runs on the Raspberry Pi to handle MSP communication. This script acts as a bridge between the Pi and the Betaflight flight controller, issuing control commands and reading telemetry over a serial connection.</p><section class="chapter"><h3 id="operational-behavior" data-toc="operational-behavior">Operational Behavior</h3><p id="-y7z7qv_49">The core logic revolves around continuously monitoring the AUX channels to determine the Pi's control behavior:</p><ul class="list _bullet" id="-y7z7qv_50"><li class="list__item" id="-y7z7qv_55"><p id="-y7z7qv_58"><span class="control" id="-y7z7qv_60">AUX3</span> (Mode Selector):</p><ul class="list _bullet" id="-y7z7qv_59"><li class="list__item" id="-y7z7qv_61"><p id="-y7z7qv_64"><span class="control" id="-y7z7qv_65">&lt; 1300</span>: MSP Override is off &ndash; the Pi remains inactive.</p></li><li class="list__item" id="-y7z7qv_62"><p id="-y7z7qv_66"><span class="control" id="-y7z7qv_67">1300&ndash;1800</span>: Stable mode &ndash; the Pi maintains the drone&rsquo;s current position.</p></li><li class="list__item" id="-y7z7qv_63"><p id="-y7z7qv_68"><span class="control" id="-y7z7qv_69">&gt; 1800</span>: Object detection mode &ndash; the Pi commands forward motion and reacts to visual input.</p></li></ul></li><li class="list__item" id="-y7z7qv_56"><p id="-y7z7qv_70"><span class="control" id="-y7z7qv_71">AUX5</span>: Activates the magnet (e.g., to pick up a package).</p></li><li class="list__item" id="-y7z7qv_57"><p id="-y7z7qv_72"><span class="control" id="-y7z7qv_73">AUX6</span>: Deactivates the magnet (e.g., to release a package).</p></li></ul><p id="-y7z7qv_51">All control logic is managed through a custom <code class="code" id="-y7z7qv_74">MSP</code> class, which sends and receives MSP messages over the serial connection. This class allows us to inject RC commands while preserving the pilot's AUX settings.</p><aside class="prompt" data-type="tip" data-title="" id="-y7z7qv_52"><p id="-y7z7qv_75">For further information on payload delivery, refer to <a href="package-transportation.html" id="-y7z7qv_76" data-tooltip="Our drone is required to handle payload pickup and drop-off of a prepared package.">Package Transportation</a>.</p></aside><aside class="prompt" data-type="tip" data-title="" id="-y7z7qv_53"><p id="-y7z7qv_77">The MSP implementation in Python includes full support for packet formatting, UART communication, and RC channel synchronization.</p></aside></section></section><section class="chapter"><h2 id="msp-communication-module" data-toc="msp-communication-module">MSP Communication Module</h2><p id="-y7z7qv_78">The <code class="code" id="-y7z7qv_83">MSP</code> class abstracts the protocol details and provides high-level methods for:</p><ul class="list _bullet" id="-y7z7qv_79"><li class="list__item" id="-y7z7qv_84"><p id="-y7z7qv_87"><span class="control" id="-y7z7qv_88">Sending RC input</span> (<code class="code" id="-y7z7qv_89">send_rc</code>)</p></li><li class="list__item" id="-y7z7qv_85"><p id="-y7z7qv_90"><span class="control" id="-y7z7qv_91">Reading current RC channel values</span> (<code class="code" id="-y7z7qv_92">read_rc</code>)</p></li><li class="list__item" id="-y7z7qv_86"><p id="-y7z7qv_93"><span class="control" id="-y7z7qv_94">Sending flight control commands</span> with pitch, roll, yaw, and throttle inputs while maintaining AUX values (<code class="code" id="-y7z7qv_95">send_flight_control</code>)</p></li></ul><p id="-y7z7qv_80">This module encodes MSP packets with proper binary formatting and checksum validation to ensure robust communication. It typically operates over <code class="code" id="-y7z7qv_96">/dev/serial0</code> (Linux) or <code class="code" id="-y7z7qv_97">COMx</code> ports (Windows).</p><p id="-y7z7qv_81">Through this abstraction, the Raspberry Pi can behave like a secondary flight controller that only overrides inputs when allowed by the MSP Override switch.</p></section><section class="chapter"><h2 id="co-pilot-flight-logic" data-toc="co-pilot-flight-logic">Co-Pilot Flight Logic</h2><section class="chapter"><h3 id="stable-mode" data-toc="stable-mode">Stable Mode</h3><p id="-y7z7qv_100">When the <code class="code" id="-y7z7qv_106">AUX3</code> channel reads between <code class="code" id="-y7z7qv_107">1400</code> and <code class="code" id="-y7z7qv_108">1900</code>, the Pi activates its &quot;Stable Mode.&quot; In this state, the Pi keeps the drone level by sending neutral RC inputs:</p><p id="-y7z7qv_101"><code class="code" id="-y7z7qv_109">roll = 1500</code></p><p id="-y7z7qv_102"><code class="code" id="-y7z7qv_110">pitch = 1500</code></p><p id="-y7z7qv_103"><code class="code" id="-y7z7qv_111">yaw = 1500</code></p><p id="-y7z7qv_104"><code class="code" id="-y7z7qv_112">throttle = (last known throttle from pilot)</code></p><p id="-y7z7qv_105">This allows the drone to maintain its attitude, assuming it was already stable at the time of mode activation. The Pi does not attempt to recover unstable motion &mdash; it simply holds the current attitude using balanced control inputs.</p></section><section class="chapter"><h3 id="object-detection-and-forward-movement" data-toc="object-detection-and-forward-movement">Object Detection and Forward Movement</h3><p id="-y7z7qv_113">When <code class="code" id="-y7z7qv_116">AUX3</code> exceeds <code class="code" id="-y7z7qv_117">1900</code>, the Pi enters &quot;Object Detection Mode.&quot; It adjusts the drone&rsquo;s behavior as follows:</p><ul class="list _bullet" id="-y7z7qv_114"><li class="list__item" id="-y7z7qv_118"><p id="-y7z7qv_121">Increases throttle slightly (adds <code class="code" id="-y7z7qv_122">+50</code> to the last known throttle input).</p></li><li class="list__item" id="-y7z7qv_119"><p id="-y7z7qv_123">Tilts the drone forward by setting <span class="control" id="-y7z7qv_124">pitch = 1600</span>.</p></li><li class="list__item" id="-y7z7qv_120"><p id="-y7z7qv_125">Uses onboard image recognition to scan for colored objects:</p><ul class="list _bullet" id="-y7z7qv_126"><li class="list__item" id="-y7z7qv_127"><p id="-y7z7qv_130">If a <span class="control" id="-y7z7qv_131">red object</span> is detected &rarr; <span class="control" id="-y7z7qv_132">yaw = 1450</span> (turn left)</p></li><li class="list__item" id="-y7z7qv_128"><p id="-y7z7qv_133">If a <span class="control" id="-y7z7qv_134">blue object</span> is detected &rarr; <span class="control" id="-y7z7qv_135">yaw = 1550</span> (turn right)</p></li><li class="list__item" id="-y7z7qv_129"><p id="-y7z7qv_136">If no object is detected &rarr; <span class="control" id="-y7z7qv_137">yaw = 1500</span> (no turn)</p></li></ul></li></ul><aside class="prompt" data-type="tip" data-title="" id="-y7z7qv_115"><p id="-y7z7qv_138">Important: Avoid switching directly from the lowest AUX3 value (Off Mode) to the highest (Object Detection Mode). Always pass through Stable Mode to ensure smooth transition and stable flight behavior.</p></aside></section></section><div class="last-modified">09 Juli 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="magnet-control-code.html" class="navigation-links__prev">Remote Magnet Control via TCP (Raspberry Pi)</a><a href="object-detection.html" class="navigation-links__next">Object Detection</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>