<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-09T14:21:46.2388537"><title>Pi as Co-Pilot | Drone Project</title><script type="application/json" id="virtual-toc-data">[{"id":"overview","level":0,"title":"Overview","anchor":"#overview"},{"id":"hardware-setup","level":0,"title":"Hardware Setup","anchor":"#hardware-setup"},{"id":"software-architecture","level":0,"title":"Software Architecture","anchor":"#software-architecture"},{"id":"msp-communication-module","level":0,"title":"MSP Communication Module","anchor":"#msp-communication-module"},{"id":"co-pilot-flight-logic","level":0,"title":"Co-Pilot Flight Logic","anchor":"#co-pilot-flight-logic"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Pi as Co-Pilot | Drone Project"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Drone Project Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/piascopilot.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Pi as Co-Pilot | Drone Project"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/piascopilot.html#webpage",
    "url": "writerside-documentation/piascopilot.html",
    "name": "Pi as Co-Pilot | Drone Project",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Drone Project Help"
}</script><!-- End Schema.org --></head><body data-id="PiAsCoPilot" data-main-title="Pi as Co-Pilot" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Drone Project  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PiAsCoPilot" id="PiAsCoPilot.md">Pi as Co-Pilot</h1><p id="ch3qr6_3">This section describes how we utilize a Raspberry Pi Zero 2W as an intelligent co-pilot for our drone system. The Raspberry Pi communicates with the Betaflight flight controller using the MultiWii Serial Protocol (MSP) over a UART interface. This setup enables semi-autonomous flight behavior while maintaining full compatibility with manual pilot inputs.</p><section class="chapter"><h2 id="overview" data-toc="overview">Overview</h2><p id="ch3qr6_10">The Raspberry Pi serves as an auxiliary flight control unit that interacts with the main flight controller. It sends RC commands and reads telemetry data using MSP over a serial interface. Depending on the flight mode selected via the Betaflight AUX3 channel, the Pi executes different behaviors.</p><p id="ch3qr6_11">There are two main operational modes:</p><ul class="list _bullet" id="ch3qr6_12"><li class="list__item" id="ch3qr6_15"><p id="ch3qr6_17"><span class="control" id="ch3qr6_18">Stable Hover Mode</span> (<code class="code" id="ch3qr6_19">AUX3: 1300&ndash;1800</code>): <br> In this mode, the Pi takes over the control sticks to maintain a level and stable hover. It continuously sends neutral control values to keep the drone steady.</p></li><li class="list__item" id="ch3qr6_16"><p id="ch3qr6_21"><span class="control" id="ch3qr6_23">Object Detection Mode</span> (<code class="code" id="ch3qr6_24">AUX3: 1800&ndash;2100</code>): <br> The Pi initiates forward motion and simultaneously performs object detection. Based on the detected object's color, it steers the drone:</p><ul class="list _bullet" id="ch3qr6_22"><li class="list__item" id="ch3qr6_26"><p id="ch3qr6_28"><span class="control" id="ch3qr6_29">Red object</span> &rarr; slight turn to the <span class="control" id="ch3qr6_30">left</span></p></li><li class="list__item" id="ch3qr6_27"><p id="ch3qr6_31"><span class="control" id="ch3qr6_32">Blue object</span> &rarr; slight turn to the <span class="control" id="ch3qr6_33">right</span></p></li></ul></li></ul><aside class="prompt" data-type="tip" data-title="" id="ch3qr6_13"><p id="ch3qr6_34">For configuration details, refer to <a href="betaflightsetup.html" id="ch3qr6_35" data-tooltip="This guide describes the steps we took to configure our drone using Betaflight.">Betaflight Setup</a>, which explains how to enable MSP Override mode.</p></aside></section><section class="chapter"><h2 id="hardware-setup" data-toc="hardware-setup">Hardware Setup</h2><p id="ch3qr6_36">To establish communication between the Raspberry Pi and the flight controller, connect the two devices via a UART interface:</p><ul class="list _bullet" id="ch3qr6_37"><li class="list__item" id="ch3qr6_41"><p id="ch3qr6_43"><span class="control" id="ch3qr6_44">Raspberry Pi TX</span> &rarr; <span class="control" id="ch3qr6_45">Flight Controller RX</span> (e.g., UART3)</p></li><li class="list__item" id="ch3qr6_42"><p id="ch3qr6_46"><span class="control" id="ch3qr6_47">Raspberry Pi RX</span> &rarr; <span class="control" id="ch3qr6_48">Flight Controller TX</span></p></li></ul><p id="ch3qr6_38">Ensure the Pi is properly powered from the drone's power system.</p><aside class="prompt" data-type="tip" data-title="" id="ch3qr6_39"><p id="ch3qr6_49">See <a href="power-supply.html" id="ch3qr6_50" data-tooltip="A challenge we faced while building our drone is how to power additional peripherals like the Raspberry Pi, its PI Camera Module, the Coral Edge TPU and the Electro Magnet.">Power Supply</a> for information on safely powering the Raspberry Pi.</p></aside></section><section class="chapter"><h2 id="software-architecture" data-toc="software-architecture">Software Architecture</h2><p id="ch3qr6_51">A custom Python script runs on the Raspberry Pi to handle MSP communication. This script acts as a bridge between the Pi and the Betaflight flight controller, issuing control commands and reading telemetry over a serial connection.</p><section class="chapter"><h3 id="operational-behavior" data-toc="operational-behavior">Operational Behavior</h3><p id="ch3qr6_53">The core logic revolves around continuously monitoring the AUX channels to determine the Pi's control behavior:</p><ul class="list _bullet" id="ch3qr6_54"><li class="list__item" id="ch3qr6_59"><p id="ch3qr6_62"><span class="control" id="ch3qr6_64">AUX3</span> (Mode Selector):</p><ul class="list _bullet" id="ch3qr6_63"><li class="list__item" id="ch3qr6_65"><p id="ch3qr6_68"><span class="control" id="ch3qr6_69">&lt; 1300</span>: MSP Override is off &ndash; the Pi remains inactive.</p></li><li class="list__item" id="ch3qr6_66"><p id="ch3qr6_70"><span class="control" id="ch3qr6_71">1300&ndash;1800</span>: Stable mode &ndash; the Pi maintains the drone&rsquo;s current position.</p></li><li class="list__item" id="ch3qr6_67"><p id="ch3qr6_72"><span class="control" id="ch3qr6_73">&gt; 1800</span>: Object detection mode &ndash; the Pi commands forward motion and reacts to visual input.</p></li></ul></li><li class="list__item" id="ch3qr6_60"><p id="ch3qr6_74"><span class="control" id="ch3qr6_75">AUX5</span>: Activates the magnet (e.g., to pick up a package).</p></li><li class="list__item" id="ch3qr6_61"><p id="ch3qr6_76"><span class="control" id="ch3qr6_77">AUX6</span>: Deactivates the magnet (e.g., to release a package).</p></li></ul><p id="ch3qr6_55">All control logic is managed through a custom <code class="code" id="ch3qr6_78">MSP</code> class, which sends and receives MSP messages over the serial connection. This class allows us to inject RC commands while preserving the pilot's AUX settings.</p><aside class="prompt" data-type="tip" data-title="" id="ch3qr6_56"><p id="ch3qr6_79">For further information on payload delivery, refer to <a href="package-transportation.html" id="ch3qr6_80" data-tooltip="Our drone is required to handle payload pickup and drop-off of a prepared package.">Package Transportation</a>.</p></aside><aside class="prompt" data-type="tip" data-title="" id="ch3qr6_57"><p id="ch3qr6_81">The MSP implementation in Python includes full support for packet formatting, UART communication, and RC channel synchronization.</p></aside></section></section><section class="chapter"><h2 id="msp-communication-module" data-toc="msp-communication-module">MSP Communication Module</h2><p id="ch3qr6_82">The <code class="code" id="ch3qr6_87">MSP</code> class abstracts the protocol details and provides high-level methods for:</p><ul class="list _bullet" id="ch3qr6_83"><li class="list__item" id="ch3qr6_88"><p id="ch3qr6_91"><span class="control" id="ch3qr6_92">Sending RC input</span> (<code class="code" id="ch3qr6_93">send_rc</code>)</p></li><li class="list__item" id="ch3qr6_89"><p id="ch3qr6_94"><span class="control" id="ch3qr6_95">Reading current RC channel values</span> (<code class="code" id="ch3qr6_96">read_rc</code>)</p></li><li class="list__item" id="ch3qr6_90"><p id="ch3qr6_97"><span class="control" id="ch3qr6_98">Sending flight control commands</span> with pitch, roll, yaw, and throttle inputs while maintaining AUX values (<code class="code" id="ch3qr6_99">send_flight_control</code>)</p></li></ul><p id="ch3qr6_84">This module encodes MSP packets with proper binary formatting and checksum validation to ensure robust communication. It typically operates over <code class="code" id="ch3qr6_100">/dev/serial0</code> (Linux) or <code class="code" id="ch3qr6_101">COMx</code> ports (Windows).</p><p id="ch3qr6_85">Through this abstraction, the Raspberry Pi can behave like a secondary flight controller that only overrides inputs when allowed by the MSP Override switch.</p></section><section class="chapter"><h2 id="co-pilot-flight-logic" data-toc="co-pilot-flight-logic">Co-Pilot Flight Logic</h2><section class="chapter"><h3 id="stable-mode" data-toc="stable-mode">Stable Mode</h3><p id="ch3qr6_104">When the <code class="code" id="ch3qr6_110">AUX3</code> channel reads between <code class="code" id="ch3qr6_111">1400</code> and <code class="code" id="ch3qr6_112">1900</code>, the Pi activates its &quot;Stable Mode.&quot; In this state, the Pi keeps the drone level by sending neutral RC inputs:</p><p id="ch3qr6_105"><code class="code" id="ch3qr6_113">roll = 1500</code></p><p id="ch3qr6_106"><code class="code" id="ch3qr6_114">pitch = 1500</code></p><p id="ch3qr6_107"><code class="code" id="ch3qr6_115">yaw = 1500</code></p><p id="ch3qr6_108"><code class="code" id="ch3qr6_116">throttle = (last known throttle from pilot)</code></p><p id="ch3qr6_109">This allows the drone to maintain its attitude, assuming it was already stable at the time of mode activation. The Pi does not attempt to recover unstable motion &mdash; it simply holds the current attitude using balanced control inputs.</p></section><section class="chapter"><h3 id="object-detection-and-forward-movement" data-toc="object-detection-and-forward-movement">Object Detection and Forward Movement</h3><p id="ch3qr6_117">When <code class="code" id="ch3qr6_120">AUX3</code> exceeds <code class="code" id="ch3qr6_121">1900</code>, the Pi enters &quot;Object Detection Mode.&quot; It adjusts the drone&rsquo;s behavior as follows:</p><ul class="list _bullet" id="ch3qr6_118"><li class="list__item" id="ch3qr6_122"><p id="ch3qr6_125">Increases throttle slightly (adds <code class="code" id="ch3qr6_126">+50</code> to the last known throttle input).</p></li><li class="list__item" id="ch3qr6_123"><p id="ch3qr6_127">Tilts the drone forward by setting <span class="control" id="ch3qr6_128">pitch = 1600</span>.</p></li><li class="list__item" id="ch3qr6_124"><p id="ch3qr6_129">Uses onboard image recognition to scan for colored objects:</p><ul class="list _bullet" id="ch3qr6_130"><li class="list__item" id="ch3qr6_131"><p id="ch3qr6_134">If a <span class="control" id="ch3qr6_135">red object</span> is detected &rarr; <span class="control" id="ch3qr6_136">yaw = 1450</span> (turn left)</p></li><li class="list__item" id="ch3qr6_132"><p id="ch3qr6_137">If a <span class="control" id="ch3qr6_138">blue object</span> is detected &rarr; <span class="control" id="ch3qr6_139">yaw = 1550</span> (turn right)</p></li><li class="list__item" id="ch3qr6_133"><p id="ch3qr6_140">If no object is detected &rarr; <span class="control" id="ch3qr6_141">yaw = 1500</span> (no turn)</p></li></ul></li></ul><aside class="prompt" data-type="tip" data-title="" id="ch3qr6_119"><p id="ch3qr6_142">Important: Avoid switching directly from the lowest AUX3 value (Off Mode) to the highest (Object Detection Mode). Always pass through Stable Mode to ensure smooth transition and stable flight behavior.</p></aside></section></section><div class="last-modified">09 Juli 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="magnet-control-code.html" class="navigation-links__prev">Remote Magnet Control via TCP (Raspberry Pi)</a><a href="betaflightsetup.html" class="navigation-links__next">Betaflight Setup</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>